<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>选择角色树</title>
<script src="../../jslib/jquery.min-1.11.js"></script>
<script src="../../js/root.js"></script>


<script type="text/javascript">
	  
	  $(function(){
		 var uid = $app.getQueryStr("uid");
		  $app.request("sys/auth/role/loadRoleTree.do?uid="+uid,function(data){
			  var arr = data.data;
			  var html = "";
			  for (var i = 0; i < arr.length; i++) {
				html+='<li><input name="'+arr[i].id+'" type="checkbox" '+(arr[i].uid?'checked="checked" ':'')+'>'+arr[i].name+'</li>'
			}
			  
			  $("#role_group").html(html);
			  
		  });
		  
	  });
	  
	  
	  function getChecks(){
		  var ids = "";
		  $("#role_group input:checked").each(function(i,e){
			  ids += $(e).attr("name")+",";
			  
		  });
		  
		  if(ids)return ids.substring(0,ids.length-1);
		  
		  return ids;
		  
	  }
	  
		function toSubmit(){
			
			var parms = {uid:$app.getQueryStr("uid"),roleids:getChecks()};
			
			$app.request("sys/auth/user/setUserRoles.do",function(data){
				 if(data.code==1){
					  goBack();
				  }else{
					  $app.alert('设置失败');
				  }
				
			},{param:parms})
			
			
		}
		
		
		//返回列表
		function goBack(){
			try {
				var index = parent.layer.getFrameIndex(window.name);
				parent.layer.close(index);
			} catch (e) {
				if(isNaN(index))window.location=backurl;
			}
		}
	</script>
  </head>
  
  <body >
 	
	<div>
				<ul id="role_group">
					
	    		</ul>
	
	</div>
<div class="btnWrap">
					<input name="" type="button" class="btn btn-primary" value="确认" onclick="toSubmit()"/>&nbsp;&nbsp;&nbsp;&nbsp;
					<input name="" type="button" class="btn btn-warning" value="取消" onclick="goBack();"/>
	    		</div>
	
 </body>
</html>